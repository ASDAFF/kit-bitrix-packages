"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var SotbitRegionsDelivery=function(){function t(l){_classCallCheck(this,t),this.tabID=document.getElementById("TAB_DELIVERY"),this.contentID=document.getElementById("DELIVERY_CONTENT");var c=this;this.tabID.addEventListener("click",function(t){c.clickTab()}),this.componentPath=l.componentPath,this.parameters=l.parameters,this.siteId=l.siteId,this.template=l.template,this.isContentLoad=!1,this.handlerResponse=function(){var i=this;if(this.rootId=l.root,this.root=document.querySelector('.detailed-tabs__tabs-content [id^="sotbit-delivery"]')||document.querySelector('.detailed-feat__item-content [id^="sotbit-delivery"]'),this.modal=this.root.querySelector('[data-entity="modal"]'),this.overlay=this.root.querySelector('[data-entity="overlay"]'),this.close=this.root.querySelector('[data-entity="close"]'),this.country=this.root.querySelectorAll('[data-entity="country"]'),this.tab=this.root.querySelectorAll('[data-entity="tab-content"]'),this.item=this.root.querySelectorAll('[data-entity="item"]'),1<this.item.length)for(var t=function(e){i.item[e].addEventListener("click",function(t){return i.chooseLocation(i.item[e].dataset.index)})},e=0;e<this.item.length;++e)t(e);if(this.filter=this.root.querySelector('[data-entity="filter-regions"]'),document.addEventListener("click",function(t){!function(t,e){t.target.closest("[data-entity = 'change-region']")&&e.showPopup()}(t,c)}),null!==this.overlay&&this.overlay.addEventListener("click",function(t){return c.closePopup()}),null!==this.close&&this.close.addEventListener("click",function(t){return i.closePopup()}),1<this.country.length)for(var o=function(e){i.country[e].addEventListener("click",function(t){return i.chooseCountry(i.country[e].dataset.countryId)})},n=0;n<this.country.length;++n)o(n);null!==this.filter&&this.filter.addEventListener("input",function(t){return i.filterItems(i.filter.value)});var a=document.querySelectorAll(".detailed-tabs__delivery-description");if(1<a.length)for(var s=a[a.length-1].textContent,r=0;a.length-1>r;r++)a[r].textContent=s;window.toggle=this.toggleWaysDelivery()},l.startAjax&&this.startAjax()}return _createClass(t,[{key:"toggleWaysDelivery",value:function(){var n=3,t=this.root.querySelector(".detailed-tabs__delivery-way-items-wrapper"),e=this.root.querySelector(".detailed-tabs__delivery-way-items-container"),i=this.root.querySelectorAll(".detailed-tabs__delivery-way-item"),o=this.root.querySelector(".detailed-tabs__delivery-way-btn-show"),a=null,s=20,r=null;function l(){t.style.height="auto",a=t.offsetHeight,r=c(n,i)+s*(n-1),t.style.height=r+"px"}function c(t,e){for(var i=null,o=0;o<n;o++)i+=e[o].offsetHeight;return i}return i.length>n&&(a=t.offsetHeight,r=c(n,i)+s*(n-1),o.style.display="flex",t.style.height=r+"px",e.classList.add("overflow"),o.addEventListener("click",function(){t.classList.contains("open")?(t.classList.remove("open"),t.style.height=c(n,i)+s+"px"):(t.classList.add("open"),t.style.height=a+"px")})),window.addEventListener("resize",function(){l()}),{calcHeight:l}}},{key:"showPopup",value:function(){this.modal.style.display="block",this.overlay.style.display="block"}},{key:"closePopup",value:function(){this.modal.style.display="none",this.overlay.style.display="none"}},{key:"chooseCountry",value:function(t){if(1<this.tab.length)for(var e=0;e<this.tab.length;++e)this.country[e].classList.remove("active"),this.tab[e].classList.remove("active"),this.tab[e].dataset.countryId==t&&(this.tab[e].classList.add("active"),this.country[e].classList.add("active"))}},{key:"filterItems",value:function(t){var e=this.root.querySelectorAll('[data-entity="item"]'),i=this.root.querySelectorAll('[data-entity="letter"]');if(t.toLowerCase(),e.length)for(var o=0;o<e.length;++o){e[o].style.display="block";var n=e[o].innerHTML.toLowerCase().trim();0<t.length&&n.substr(0,t.length)!=t&&(e[o].style.display="none")}if(i.length)for(o=0;o<i.length;++o){for(var a=!1,s=i[o].childNodes,r=0;r<s.length;++r)if(void 0!==s[r].dataset&&"item-list"==s[r].dataset.entity){var l=s[r].childNodes;if(l.length)for(var c=0;c<l.length;++c){if(void 0!==l[c].dataset&&"item"==l[c].dataset.entity)if("none"!=getComputedStyle(l[c]).display){a=!0;break}}}i[o].style.display="block",a||(i[o].style.display="none")}}},{key:"chooseLocation",value:function(t){BX.showWait();var e={siteId:this.siteId,template:this.template,parameters:this.parameters},i={Id:t};BX.ajax({url:this.componentPath+"/ajax.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":""),method:"POST",dataType:"html",timeout:60,data:BX.merge(e,i),onsuccess:BX.delegate(function(t){this.root.outerHTML=t,this.handlerResponse()},this)}),BX.closeWait()}},{key:"clickTab",value:function(){if(!this.isContentLoad){var t={siteId:this.siteId,template:this.template,parameters:this.parameters};createLoadersMore($(this.contentID)),BX.ajax({url:this.componentPath+"/ajax.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":""),method:"POST",dataType:"html",timeout:60,async:!0,data:t,onsuccess:BX.delegate(function(t){this.contentID.innerHTML=t,this.isContentLoad=!0,removeLoadersMore($(this.contentID)),this.handlerResponse(),window.innerWidth<=768&&($("#TAB_DELIVERY").click(),$("#TAB_DELIVERY").click())},this)})}}},{key:"startAjax",value:function(){this.clickTab()}}]),t}();