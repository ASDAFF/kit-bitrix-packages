!function(t){if(!t.JCCatalogProductSubscribe){var e=function(t){e.superclass.constructor.apply(this,arguments),this.nameNode=BX.create("span",{props:{id:this.id},style:"object"==typeof t.style?t.style:{},text:t.text}),this.buttonNode=BX.create("span",{attrs:{className:t.className},style:{marginBottom:"0",borderBottom:"0 none transparent"},children:[this.nameNode],events:this.contextEvents}),BX.browser.IsIE()&&this.buttonNode.setAttribute("hideFocus","hidefocus")};BX.extend(e,BX.PopupWindowButton),t.JCCatalogProductSubscribe=function(t){this.buttonId=t.buttonId,this.buttonClass=t.buttonClass,this.jsObject=t.jsObject,this.ajaxUrl="/bitrix/components/bitrix/catalog.product.subscribe/ajax.php",this.alreadySubscribed=t.alreadySubscribed,this.listIdAlreadySubscribed=t.listIdAlreadySubscribed,this.urlListSubscriptions=t.urlListSubscriptions,this.listOldItemId={},this.landingId=t.landingId,this.elemButtonSubscribe=null,this.elemPopupWin=null,this.defaultButtonClass="bx-catalog-subscribe-button",this.iconUse=t.iconUse,this.textShow=t.textShow,this._elemButtonSubscribeClickHandler=BX.delegate(this.subscribe,this),this._elemHiddenClickHandler=BX.delegate(this.checkSubscribe,this),BX.ready(BX.delegate(this.init,this))},t.JCCatalogProductSubscribe.prototype.init=function(){this.buttonId&&(this.elemButtonSubscribe=BX(this.buttonId),this.elemHiddenSubscribe=BX(this.buttonId+"_hidden")),this.elemButtonSubscribe&&BX.bind(this.elemButtonSubscribe,"click",this._elemButtonSubscribeClickHandler),this.elemHiddenSubscribe&&BX.bind(this.elemHiddenSubscribe,"click",this._elemHiddenClickHandler),this.setButton(this.alreadySubscribed),this.setIdAlreadySubscribed(this.listIdAlreadySubscribed)},t.JCCatalogProductSubscribe.prototype.checkSubscribe=function(){this.elemHiddenSubscribe&&this.elemButtonSubscribe&&(this.listOldItemId.hasOwnProperty(this.elemButtonSubscribe.dataset.item)?this.setButton(!0):BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{sessid:BX.bitrix_sessid(),checkSubscribe:"Y",itemId:this.elemButtonSubscribe.dataset.item},onsuccess:BX.delegate(function(t){t.subscribe?(this.setButton(!0),this.listOldItemId[this.elemButtonSubscribe.dataset.item]=!0):this.setButton(!1)},this)}))},t.JCCatalogProductSubscribe.prototype.subscribe=function(){if(this.elemButtonSubscribe=BX.proxy_context,!this.elemButtonSubscribe)return!1;BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{sessid:BX.bitrix_sessid(),subscribe:"Y",itemId:this.elemButtonSubscribe.dataset.item,siteId:BX.message("SITE_ID"),landingId:this.landingId},onsuccess:BX.delegate(function(t){if(t.success)this.createSuccessPopup(t),this.setButton(!0),this.listOldItemId[this.elemButtonSubscribe.dataset.item]=!0;else if(t.contactFormSubmit){this.initPopupWindow(),this.elemPopupWin.setTitleBar(BX.message("CPST_SUBSCRIBE_POPUP_TITLE"));var s=this.createContentForPopup(t);this.elemPopupWin.setContent(s),this.elemPopupWin.setButtons([new e({text:BX.message("CPST_SUBSCRIBE_BUTTON_NAME"),className:"intec-button intec-button-cl-common",events:{click:BX.delegate(function(){if(!this.validateContactField(t.contactTypeData))return!1;BX.ajax.submitAjax(s,{method:"POST",url:this.ajaxUrl,processData:!0,onsuccess:BX.delegate(function(t){if((t=BX.parseJSON(t,{})).success)this.createSuccessPopup(t),this.setButton(!0),this.listOldItemId[this.elemButtonSubscribe.dataset.item]=!0;else if(t.error){t.hasOwnProperty("setButton")&&(this.listOldItemId[this.elemButtonSubscribe.dataset.item]=!0,this.setButton(!0));var e=t.message;t.hasOwnProperty("typeName")&&(e=t.message.replace("USER_CONTACT",t.typeName)),BX("bx-catalog-subscribe-form-notify").style.color="red",BX("bx-catalog-subscribe-form-notify").innerHTML=e}},this)})},this)}}),new e({text:BX.message("CPST_SUBSCRIBE_BUTTON_CLOSE"),className:"intec-button intec-button-cl-common",events:{click:BX.delegate(function(){this.elemPopupWin.destroy()},this)}})]),this.elemPopupWin.show()}else t.error&&(t.hasOwnProperty("setButton")&&(this.listOldItemId[this.elemButtonSubscribe.dataset.item]=!0,this.setButton(!0)),this.showWindowWithAnswer({status:"error",message:t.message}))},this)})},t.JCCatalogProductSubscribe.prototype.validateContactField=function(t){var e=BX.findChildren(BX("bx-catalog-subscribe-form"),{tag:"input",attribute:{id:"userContact"}},!0);if(!e.length||"object"!=typeof t)return BX("bx-catalog-subscribe-form-notify").style.color="red",BX("bx-catalog-subscribe-form-notify").innerHTML=BX.message("CPST_SUBSCRIBE_VALIDATE_UNKNOW_ERROR"),!1;for(var s,i,a,o=[],c=[],n=0;n<e.length;n++)s=e[n].getAttribute("data-id"),i=e[n].value,(a=BX("bx-contact-use-"+s))&&"N"==a.value?c.push(!0):i.length||o.push(BX.message("CPST_SUBSCRIBE_VALIDATE_ERROR_EMPTY_FIELD").replace("#FIELD#",t[s].contactLable));if(e.length==c.length)return BX("bx-catalog-subscribe-form-notify").style.color="red",BX("bx-catalog-subscribe-form-notify").innerHTML=BX.message("CPST_SUBSCRIBE_VALIDATE_ERROR"),!1;if(o.length){BX("bx-catalog-subscribe-form-notify").style.color="red";for(var r=0;r<o.length;r++)BX("bx-catalog-subscribe-form-notify").innerHTML=o[r];return!1}return!0},t.JCCatalogProductSubscribe.prototype.reloadCaptcha=function(){BX.ajax.get(this.ajaxUrl+"?reloadCaptcha=Y","",function(t){BX("captcha_sid").value=t,BX("captcha_img").src="/bitrix/tools/captcha.php?captcha_sid="+t})},t.JCCatalogProductSubscribe.prototype.createContentForPopup=function(t){if(!t.hasOwnProperty("contactTypeData"))return null;var e=t.contactTypeData,s=Object.keys(e).length,i="",a="N",o=document.createDocumentFragment();for(var c in s>1&&(a="Y",i="display:none;",o.appendChild(BX.create("p",{text:BX.message("CPST_SUBSCRIBE_MANY_CONTACT_NOTIFY")}))),o.appendChild(BX.create("p",{props:{id:"bx-catalog-subscribe-form-notify"}})),e)s>1&&o.appendChild(BX.create("div",{props:{className:"bx-catalog-subscribe-form-container"},children:[BX.create("div",{props:{className:"checkbox"},children:[BX.create("lable",{props:{className:"bx-filter-param-label"},attrs:{onclick:this.jsObject+".selectContactType("+c+", event);"},children:[BX.create("input",{props:{type:"hidden",id:"bx-contact-use-"+c,name:"contact["+c+"][use]",value:"N"}}),BX.create("input",{props:{id:"bx-contact-checkbox-"+c,type:"checkbox"}}),BX.create("span",{props:{className:"bx-filter-param-text"},text:e[c].contactLable})]})]})]})),o.appendChild(BX.create("div",{props:{id:"bx-catalog-subscribe-form-container-"+c,className:"bx-catalog-subscribe-form-container",style:i},children:[BX.create("div",{props:{className:"bx-catalog-subscribe-form-container-label"},text:BX.message("CPST_SUBSCRIBE_LABLE_CONTACT_INPUT").replace("#CONTACT#",e[c].contactLable)}),BX.create("div",{props:{className:"bx-catalog-subscribe-form-container-input"},children:[BX.create("input",{props:{id:"userContact",className:"inputtext intec-ui intec-ui-control-input intec-ui-mod-block intec-ui-mod-round-3",type:"text",name:"contact["+c+"][user]"},attrs:{"data-id":c}})]})]}));t.hasOwnProperty("captchaCode")&&o.appendChild(BX.create("div",{props:{className:"bx-catalog-subscribe-form-container"},children:[BX.create("span",{props:{className:"bx-catalog-subscribe-form-star-required"},text:"*"}),BX.message("CPST_ENTER_WORD_PICTURE"),BX.create("div",{props:{className:"bx-captcha"},children:[BX.create("input",{props:{type:"hidden",id:"captcha_sid",name:"captcha_sid",value:t.captchaCode}}),BX.create("img",{props:{id:"captcha_img",src:"/bitrix/tools/captcha.php?captcha_sid="+t.captchaCode},attrs:{width:"180",height:"40",alt:"captcha",onclick:this.jsObject+".reloadCaptcha();"}})]}),BX.create("div",{props:{className:"bx-catalog-subscribe-form-container-input"},children:[BX.create("input",{props:{id:"captcha_word",className:"",type:"text",name:"captcha_word"},attrs:{maxlength:"50"}})]})]}));var n=BX.create("form",{props:{id:"bx-catalog-subscribe-form"},children:[BX.create("input",{props:{type:"hidden",name:"manyContact",value:a}}),BX.create("input",{props:{type:"hidden",name:"sessid",value:BX.bitrix_sessid()}}),BX.create("input",{props:{type:"hidden",name:"itemId",value:this.elemButtonSubscribe.dataset.item}}),BX.create("input",{props:{type:"hidden",name:"landingId",value:this.landingId}}),BX.create("input",{props:{type:"hidden",name:"siteId",value:BX.message("SITE_ID")}}),BX.create("input",{props:{type:"hidden",name:"contactFormSubmit",value:"Y"}})]});return n.appendChild(o),n},t.JCCatalogProductSubscribe.prototype.selectContactType=function(e,s){var i=BX("bx-catalog-subscribe-form-container-"+e),a="",o=BX("bx-contact-checkbox-"+e);if(!i)return!1;if(o!=s.target&&(o.checked?o.checked=!1:o.checked=!0),i.currentStyle)a=i.currentStyle.display;else if(t.getComputedStyle){a=t.getComputedStyle(i,null).getPropertyValue("display")}"none"===a?(BX("bx-contact-use-"+e).value="Y",BX.style(i,"display","")):(BX("bx-contact-use-"+e).value="N",BX.style(i,"display","none"))},t.JCCatalogProductSubscribe.prototype.createSuccessPopup=function(t){this.initPopupWindow(),this.elemPopupWin.setTitleBar(BX.message("CPST_SUBSCRIBE_POPUP_TITLE"));var s=BX.create("div",{props:{className:"bx-catalog-popup-content"},children:[BX.create("p",{props:{className:"bx-catalog-popup-message"},text:t.message})]});this.elemPopupWin.setContent(s),this.elemPopupWin.setButtons([new e({text:BX.message("CPST_SUBSCRIBE_BUTTON_CLOSE"),className:"intec-button intec-button-cl-common",events:{click:BX.delegate(function(){this.elemPopupWin.destroy()},this)}})]),this.elemPopupWin.show()},t.JCCatalogProductSubscribe.prototype.initPopupWindow=function(){this.elemPopupWin=BX.PopupWindowManager.create("CatalogSubscribe_"+this.buttonId,null,{autoHide:!1,offsetLeft:0,offsetTop:0,overlay:!0,closeByEsc:!0,titleBar:!0,closeIcon:!0,contentColor:"white",className:"popup-window-subscribe"})},t.JCCatalogProductSubscribe.prototype.setButton=function(t){this.alreadySubscribed=Boolean(t),this.alreadySubscribed?(this.elemButtonSubscribe.className=this.buttonClass+" "+this.defaultButtonClass+" disabled",this.iconUse&&this.textShow?this.elemButtonSubscribe.innerHTML='<i class="far fa-bell"></i><span>'+BX.message("CPST_TITLE_ALREADY_SUBSCRIBED")+"</span>":this.iconUse&&!this.textShow?this.elemButtonSubscribe.innerHTML='<i class="far fa-bell"></i>':this.elemButtonSubscribe.innerHTML="<span>"+BX.message("CPST_TITLE_ALREADY_SUBSCRIBED")+"</span>",BX.unbind(this.elemButtonSubscribe,"click",this._elemButtonSubscribeClickHandler)):(this.elemButtonSubscribe.className=this.buttonClass+" "+this.defaultButtonClass,this.iconUse&&this.textShow?this.elemButtonSubscribe.innerHTML='<i class="far fa-bell"></i><span>'+BX.message("CPST_SUBSCRIBE_BUTTON_NAME")+"</span>":this.iconUse&&!this.textShow?this.elemButtonSubscribe.innerHTML='<i class="far fa-bell"></i>':this.elemButtonSubscribe.innerHTML="<span>"+BX.message("CPST_SUBSCRIBE_BUTTON_NAME")+"</span>",BX.bind(this.elemButtonSubscribe,"click",this._elemButtonSubscribeClickHandler))},t.JCCatalogProductSubscribe.prototype.setIdAlreadySubscribed=function(t){BX.type.isPlainObject(t)&&(this.listOldItemId=t)},t.JCCatalogProductSubscribe.prototype.showWindowWithAnswer=function(t){(t=t||{}).message||("success"==t.status?t.message=BX.message("CPST_STATUS_SUCCESS"):t.message=BX.message("CPST_STATUS_ERROR"));var e=BX.create("div",{props:{className:"bx-catalog-subscribe-alert"},children:[BX.create("span",{props:{className:"bx-catalog-subscribe-aligner"}}),BX.create("span",{props:{className:"bx-catalog-subscribe-alert-text"},text:t.message}),BX.create("div",{props:{className:"bx-catalog-subscribe-alert-footer"}})]}),s=BX.PopupWindowManager.getCurrentPopup();s&&s.destroy();var i=setTimeout(function(){var t=BX.PopupWindowManager.getCurrentPopup();t&&"bx-catalog-subscribe-status-action"==t.uniquePopupId&&(t.close(),t.destroy())},3500);BX.PopupWindowManager.create("bx-catalog-subscribe-status-action",null,{content:e,onPopupClose:function(){this.destroy(),clearTimeout(i)},autoHide:!0,zIndex:2e3,className:"bx-catalog-subscribe-alert-popup"}).show(),BX("bx-catalog-subscribe-status-action").onmouseover=function(t){clearTimeout(i)},BX("bx-catalog-subscribe-status-action").onmouseout=function(t){i=setTimeout(function(){var t=BX.PopupWindowManager.getCurrentPopup();t&&"bx-catalog-subscribe-status-action"==t.uniquePopupId&&(t.close(),t.destroy())},3500)}}}}(window);